<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Booking Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
</head>
<body>
    <div class="container my-4">
        <h1 class="text-center">Hotel Booking Calendar</h1>
        <button class="btn btn-primary" onclick="openBookingForm()">+ Add Booking</button>
        <div id="calendar" class="mt-4"></div>
    </div>

    <div class="modal" id="bookingModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Book a Room</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="bookingForm">
                        <label>Customer Name:</label><input type="text" name="customer" class="form-control" required>
                        <label>Phone Number:</label><input type="text" name="phone" class="form-control" required>
                        <label>Room Number:</label><input type="text" name="room" class="form-control" required>
                        <label>Channel:</label><input type="text" name="channel" class="form-control">
                        <label>Check-in Date:</label><input type="date" name="checkin" class="form-control" required>
                        <label>Check-out Date:</label><input type="date" name="checkout" class="form-control" required>
                        <label>Payment Method:</label>
                        <select name="payment" class="form-control">
                            <option value="Cash">Cash</option>
                            <option value="Credit Card">Credit Card</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                        </select>
                        <label>Payment Proof:</label><input type="file" name="payment_proof" class="form-control">
                        <button type="submit" class="btn btn-success mt-3">Confirm Booking</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                events: '/get_bookings',
                selectable: true,
                dateClick: function(info) {
                    document.getElementById('bookingForm').reset();
                    document.querySelector('[name="checkin"]').value = info.dateStr;
                    $('#bookingModal').modal('show');
                }
            });
            calendar.render();
        });

        document.getElementById("bookingForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let formData = new FormData(this);
            fetch('/book', { method: 'POST', body: formData })
            .then(response => response.json())
            .then(data => { alert(data.message); location.reload(); });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
